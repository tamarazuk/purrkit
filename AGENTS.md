# Agent Guide

This repo is a Turborepo monorepo. Use shared configs and consistent scripts when adding new packages.

## Experiments

Experiments live under `experiments/`:

- `experiments/active/*` uses standard scripts (`dev`, `build`, `lint`, `check-types`) and is part of Turbo runs.
- `experiments/scratch/*` is still workspace-aware but uses non-standard script names (e.g. `scratch:dev`) so Turbo ignores it by default.
- `experiments/archived/*` is excluded from the workspace.

Use the scaffold command when possible:
```bash
pnpm experiment:new my-idea --scratch
pnpm experiment:new my-idea --active
```

## New Next.js App (Using Create Next App)

If you use Create Next App (CNA) anywhere in the repo, clean it up and align it to the monorepo:

1) Run CNA inside the target folder:
```bash
pnpm dlx create-next-app@latest .
```

2) Remove CNA extras that we don't use in the monorepo:
- Delete `/public` if unused
- Delete `/styles` if created
- Delete `/app/api` routes if unused
- Remove any `README.md` generated by CNA if this is only an internal experiment

3) Align `package.json` with monorepo versions and scripts (adjust name based on location):
```json
{
  "name": "@purrkit/<package-name>",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev --port 3075",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "check-types": "next typegen && tsc --noEmit"
  },
  "dependencies": {
    "next": "16.1.1",
    "react": "19.2.3",
    "react-dom": "19.2.3"
  },
  "devDependencies": {
    "@purrkit/eslint-config": "workspace:*",
    "@purrkit/typescript-config": "workspace:*",
    "@types/node": "25.0.3",
    "@types/react": "19.2.7",
    "@types/react-dom": "19.2.3",
    "eslint": "^9.39.2",
    "eslint-config-next": "16.1.1",
    "typescript": "5.9.3"
  }
}
```

Use `@purrkit/exp-<slug>` for `experiments/*`. Use `@purrkit/<app-name>` for real apps/packages/templates.

4) `eslint.config.js`:
```js
import { nextJsConfig } from "@purrkit/eslint-config/next-js";

/** @type {import("eslint").Linter.Config[]} */
export default nextJsConfig;
```

5) `tsconfig.json`:
```json
{
  "extends": "@purrkit/typescript-config/nextjs.json",
  "compilerOptions": {
    "paths": {
      "@/*": ["./*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts"
  ],
  "exclude": ["node_modules"]
}
```

6) Ensure `next-env.d.ts` exists (CNA already creates it):
```ts
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file is generated by Next.js; do not edit.
```

7) Trim `app/` to the minimal structure you need:
```tsx
// app/layout.tsx
import type { ReactNode } from "react";

export default function RootLayout({ children }: { children: ReactNode }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  );
}
```

```tsx
// app/page.tsx
export default function Page() {
  return <main>Experiment ready.</main>;
}
```

For scratch experiments, use `scratch:*` script names to avoid Turbo runs.
